!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).formsaver=t()}(this,function(){"use strict";function e(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(62*Math.random()));return t}var t=window.self!==window.top,n=new URL(t?document.referrer:document.location.href).pathname;var r=n.replace(/\/$/,"")+"/formField",o=localStorage.getItem(r.toString()),i=o?JSON.parse(o):[],a=e(5),c=-1;"undefined"!=typeof jQuery&&function(e){e.fn.getIDName=function(){return e(this).attr("aria-autovalue")&&e(this).val(a).trigger("change"),e(this).attr("name")||e(this).attr("id")},e.fn.has_attr=function(t){var n=e(this).attr(t);return void 0!==n&&!1!==n},e.fn.smartForm=function(){c++,new s(e(this).get(0))},e.arrive=function(t,n){t?e(t).bind("DOMNodeInserted",n):"function"==typeof n?e(document).bind("DOMNodeInserted",n):"function"==typeof t&&e(document).bind("DOMNodeInserted",t)}}(jQuery);var s=function(){function t(e,t){var n=this;"object"!=typeof t&&(t={}),void 0===(t=Object.assign({debug:!1,method:"vanilla"},t)).debug&&(t.debug=!1,console.log("change debug to false")),this.restore(e,t.debug),"jquery"==t.method&&this.is_jquery()?this.jquery_listener():(console.log("vanilla listener started"),this.vanilla_listener(e,function(){n.save(e,t.debug)}))}return t.prototype.offset=function(e){return e.getBoundingClientRect()},t.prototype.jquery_listener=function(){var e=this;$(document).bind("DOMNodeInserted",function(){switch($(this).prop("tagName")){case"SELECT":case"INPUT":case"TEXTAREA":e.restore($(this).get(0))}}),$(document).bind("DOMNodeRemoved",function(){var e=$(this);if(!e.attr("no-save")&&e.attr("formsaver-integrity"))switch(e.prop("tagName")){case"SELECT":case"INPUT":case"TEXTAREA":e.off("change")}}),$(document).on("change","select, input, textarea",function(t){e.save(this)}),$(document).on("focus","input,textarea,select",function(){var e=$(this);e.getIDName();var t=e.attr("formsaver-integrity");t&&t!=a&&(console.log("aria id invalid"),e.smartForm(),e.attr("formsaver-integrity",a))})},t.prototype.vanilla_listener=function(e,t){e.addEventListener?e.addEventListener("change",t):e.attachEvent&&e.attachEvent("onchange",t)},t.prototype.hasAttribute=function(e,t){return 1===e.nodeType&&e.hasAttribute(t)},t.prototype.convertElement=function(e){return this.is_jquery()&&e instanceof jQuery&&(e=e.get(0)),e.nodeType,e},t.prototype.isIgnored=function(e,t){void 0===t&&(t=!1);var n=e.hasAttribute("no-save");if(t){var r=e.id||e.getAttribute("name")||this.get_identifier(e)||"unidentified element";console.log('id="'.concat(r,'" is ignored (').concat(n,")"))}return n},t.prototype.restore=function(e,t){if(void 0===t&&(t=!1),e=this.convertElement(e),c++,this.isIgnored(e,t))"value"in e&&(e.value="");else{var n;e.setAttribute("formsaver-integrity",a);var r=this.get_identifier(e),o=e.getAttribute("type");if(r.length>0){if("checkbox"===o){if(null===(n=JSON.parse(localStorage.getItem(r))))return;return t&&console.log("restore value checkbox[".concat(r,"] ").concat(n)),void(e.checked=n)}if("radio"===o){var i=localStorage.getItem(r);(function(e){if(null==e)return!1;try{JSON.parse(e)}catch(e){return!1}return!0})(i)&&(i=JSON.parse(i));for(var s=document.getElementsByName(e.getAttribute("name")),u=0;u<s.length;u++)s[u].checked=!1;return void setTimeout(function(){i&&"object"==typeof i&&Object.prototype.hasOwnProperty.call(i,"index")&&(s[i.index].checked=!0,t&&console.log("restoring checkbox",i))},1e3)}if(null===(n=localStorage.getItem(r))||!n.toString().length)return;this.isIgnored(e,t)||(e.value=n,this.is_select2(e)&&(console.log("restoring ".concat(e.getAttribute("id")," which Initialized with select2")),"undefined"!=typeof jQuery&&$(e).val(n).trigger("change"))),t&&console.log("load",o,r,n)}}},t.prototype.save=function(e,t){void 0===t&&(t=!1),e=this.convertElement(e);var n=this.get_identifier(e),r=e.value,o=!e.hasAttribute("no-save")&&e.hasAttribute("formsaver-integrity")&&e.hasAttribute("name"),i=e.getAttribute("type");if(t&&console.log("".concat(e.tagName," ").concat(n," ").concat(o)),n&&o){if("checkbox"==i)return localStorage.setItem(n,(1==e.checked).toString()),void(t&&console.log("save checkbox button ",this.offset(e)));if("radio"!=i){if(function(e){if(null==e)return!0;if("string"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Map||e instanceof Set)return 0===e.size;if("object"==typeof e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}return!1}(r))return localStorage.removeItem(n),void(t&&console.log("removed empty value",n));localStorage.setItem(n,r.toString())}else{for(var a=document.getElementsByName(e.getAttribute("name")),c=function(e){for(var t={},n=0,r=e.length;n<r;n++)e[n].checked&&(t={value:e[n].value,index:n,id:this.get_identifier(e[n])});return t}(a),s=0;s<a.length;s++)if(Object.prototype.hasOwnProperty.call(a,s)){var u=a[s];this.delete(u,t)}setTimeout(function(){localStorage.setItem(n,JSON.stringify(c)),t&&console.log("save radio button ",c)},1e3)}}},t.prototype.delete=function(e,t){void 0===t&&(t=!1),e=this.convertElement(e);var n=this.get_identifier(e);t&&console.log("deleting ".concat(n)),localStorage.removeItem(n)},t.prototype.is_select2=function(e){return this.is_jquery()&&$(e).data("select2")},t.prototype.is_jquery=function(){return"undefined"!=typeof jQuery},t.prototype.get_identifier=function(t){var o=function(n){var o;return c in i?(o=i[c],t.setAttribute(n,o)):(o=e(5),t.setAttribute(n,o),i[c]=o,localStorage.setItem(r.toString(),JSON.stringify(i))),c++,o},a=function(n){var o=e(5);return t.setAttribute(n,o),i[c]=o,localStorage.setItem(r.toString(),JSON.stringify(i)),o},s=null,u=null;return(t=this.convertElement(t)).hasAttribute("id")?"null"==t.getAttribute("id")&&(u=a("id")):s=o("id"),t.hasAttribute("name")?"null"==t.getAttribute("name")&&("string"!=typeof u?a("name"):t.setAttribute("name",u)):"string"!=typeof s?o("name"):t.setAttribute("name",s),n+t.getAttribute("id")},t}();return function(e){if(void 0===e&&(e=!1),"undefined"!=typeof jQuery)e&&console.log("starting form saver with jQuery debug(".concat(e,")")),"undefined"!=typeof jQuery&&jQuery("input,textarea,select").each(function(t,n){new s(this,{debug:e,method:"jquery"})});else{e&&console.log("starting form saver without jQuery debug(".concat(e,")"));var t=document.querySelectorAll("input,textarea,select");e&&console.log(t),t.forEach(function(t,n,r){new s(t,{debug:e,method:"vanilla"})})}}});
//# sourceMappingURL=bundle.min.js.map
